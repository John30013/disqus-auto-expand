import{defaultConfig}from"./dax-defaultConfig.js";let _config={...defaultConfig};function initUiText(){const e=chrome.runtime.getManifest();_config.doDebug&&console.debug("Manifest: %o",e),document.querySelectorAll(".version").forEach(o=>{o.innerHTML=e.version}),document.querySelectorAll("a.extensionStore").forEach(e=>{e.href="https://chrome.google.com/webstore/detail/disqus-auto-expander/fpbfgpbppogiblppnplbkkcdmnklnbao?hl=en&gl=US",e.innerText="Chrome Web Store"})}function getCurrentConfig(){chrome.storage.sync.get(defaultConfig,e=>{if(chrome.runtime.lastError)console.info("Couldn't initialize config from storage: %s",chrome.runtime.lastError.message);else{console.debug("config.js loaded."),console.debug("Setting config from storage: %o",e);for(let o in e){_config[o]=e[o];let t=document.getElementById(o);t?"checkbox"===t.type?(t.checked=e[o],"useDarkTheme"===o?(document.body.classList.toggle("theme-dark",t.checked),_config.doDebug&&console.debug("--\x3e document.body class: %s",document.body.className)):"isEnabled"===o&&setEnabledStateUi(t.checked),_config.doDebug&&console.debug("--\x3e %s checkbox %s.",t.checked?"Checked":"Unchecked",o)):"checkInterval"===o&&(t.value=""+e[o],_config.doDebug&&console.debug("--\x3e %s set to %s.",o,t.value)):_config.doDebug&&console.debug('--\x3e Skipped config option "%s" with no control.',o)}}})}function listenForUpdates(){function e(e,o){_config[e]=o;const t={action:"updateConfig",data:{key:e,value:o},sender:"config"};chrome.runtime.sendMessage(t),"isEnabled"===e&&setEnabledStateUi(o)}document.body.addEventListener("input",o=>{_config.doDebug&&console.debug("Handling change event on %s",o.target.id,o);let t=o.target,n=null,c=null;"checkInterval"===t.id?(c&&clearTimeout(c),c=setTimeout(o=>{o.validity.valid?e(o.id,+o.value):chrome.storage.sync.get(o.id,e=>{chrome.runtime.lastError?console.info("Couldn't get config value %s from storage: %s",o.id,chrome.runtime.lastError.message):o.value=e[o.id]})},3e3,t)):(n=t.checked,"useDarkTheme"===t.id&&(document.body.classList.toggle("theme-dark",t.checked),_config.doDebug&&console.debug("--\x3e document.body className: %s",document.body.className)),e(t.id,n))})}function setEnabledStateUi(e){document.querySelectorAll("section:first-of-type > div input").forEach(o=>o.disabled=!e)}initUiText(),getCurrentConfig(),listenForUpdates();